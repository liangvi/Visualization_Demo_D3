<!doctype html>

<html lang="en">
  <head>
  <title>This is the title of the webpage!</title>
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!--<script src="http://d3js.org/topojson.v1.min.js"></script>-->
  <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  	<!--d3 Import -->
  <script src="https://d3js.org/d3.v5.min.js"></script>

  <!-- map -->
  <!-- https://bl.ocks.org/mbostock/4206573-->
  <!-- http://duspviz.mit.edu/d3-workshop/mapping-data-with-d3/ -->
  <!-- https://bl.ocks.org/JulienAssouline/1ae3480c5277e2eecd34b71515783d6f -->
    <script type="text/javascript" src="static/js/main.js"></script>
    <link rel="stylesheet" type="text/css" href="static/css/main.css">

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta charset="utf-8">
  </head>
  <body>

<div class="container-flud">

    <!--https://getbootstrap.com/docs/4.0/components/buttons/-->

 <div class="btn-group btn-group-lg" role="group" aria-label="...">
    <a class="btn btn-primary" href="/" role="button">
        Explore
    </a>
    <a class="btn btn-primary" href="/compare/all/all" role="button">
        Compare
    </a>
    <a class="btn btn-primary" href="/analysis" role="button">
        Analysis
    </a>
  </div>
    <!--https://observablehq.com/@d3/u-s-state-capitals-->
    <!--http://bl.ocks.org/stevenae/8362841-->
  </body>
    <script type="text/javascript" src="/static/js/index.js"></script>
    <!--<script type="text/javascript">
        console.log("and the current time is:", Date.now());
        //drawMap({{ data }} {{ json|tojson }} );
        drawMap({{ json|tojson }} );
    </script>-->
    <!-- https://www.d3-graph-gallery.com/graph/choropleth_basic.html -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

    <!-- Create an element where the map will take place -->
    <svg id="choropleth" width="400" height="300"></svg>
    <script>

      // The svg
      var w = 500;
      var h = 300;

    var margin = {
        top: 60,
        bottom: 40,
        left: 70,
        right: 40
      };

      var width = w - margin.left - margin.right;
      var height = h - margin.top - margin.bottom;


    // define map projection
    var projection = d3.geoAlbersUsa()
      .translate([w/2, h/2])
      .scale([500]);

    //Define default path generator
    var path = d3.geoPath()
      .projection(projection);

    var svg = d3.select("body")
      .append("svg")
      .attr("id", "chart")
      .attr("width", w)
      .attr("height", h)
      .append("g")
      .attr("tranform", "translate(0" + margin.left + "," + margin.top + ")");

      var color = d3.scaleQuantile()
        .range(["rgb(237, 248, 233)", "rgb(186, 228, 179)", "rgb(116,196,118)", "rgb(49,163,84)", "rgb(0,109,44)"]);

    d3.csv("data/cities.csv", function(data){

      color.domain([ d3.min(data, function(d){ return d.value; }),
        d3.max(data, function(d){ return d.value; })
        ]);

    d3.json(json, function(json){

      //Merge the agriculture and GeoJSON data
      //Loop through once for each agriculture data value
      for(var i = 0; i < data.length; i++){
        // grab state name
        var dataState = data[i].state;

        //grab data value, and convert from string to float
        var dataValue = parseFloat(data[i].value);

        //find the corresponding state inside the GeoJSON
        for(var n = 0; n < json.features.length; n++){

          // properties name gets the states name
          var jsonState = json.features[n].properties.name;
          // if statment to merge by name of state
          if(dataState == jsonState){
            //Copy the data value into the JSON
            // basically creating a new value column in JSON data
            json.features[n].properties.value = dataValue;

            //stop looking through the JSON
            break;
          }
        }
      }

      svg.selectAll("path")
        .data(json.features)
        .enter()
        .append("path")
        .attr("d", path)
        .style("fill", function(d){
          //get the data value
          var value = d.properties.value;

          if(value){
            //If value exists
            return color(value);
          } else {
            // If value is undefined
            //we do this because alaska and hawaii are not in dataset we are using but still in projections
            return "#ccc"
          }

        });


    });

})
      </script>




                <!-- samples
  <script type="text/javascript" src="static/js/barDemo.js"></script>
  <script type="text/javascript" src="static/js/scatterDemo.js"></script>
  -->

</html>
